I"—<h1 id="gerrit-widget">Gerrit widget</h1>

<p>It shows number of currently assigned reviews in <a href="https://www.gerritcodereview.com/">Gerrit</a> to the user (by default) :</p>

<p><img src="../awesome-wm-widgets/assets/img/widgets/screenshots/gerrit-widget/gerrit_widget.png" alt="gerrit_widget" /></p>

<p>when clicked it shows reviews in a list:</p>

<p><img src="../awesome-wm-widgets/assets/img/widgets/screenshots/gerrit-widget/popup.png" alt="popup" /></p>

<p>left click on an item will open review in the default browser, right click will copy the review number, which you can use to checkout this review by running <code class="language-plaintext highlighter-rouge">git-review -d &lt;review number&gt;</code>.</p>

<p>Also, if a new review is assigned to the user, there will be a pop-up:</p>

<p><img src="../awesome-wm-widgets/assets/img/widgets/screenshots/gerrit-widget/new_review.png" alt="new_review" /></p>

<h2 id="customization">Customization</h2>

<p>It is possible to customize widget by providing a table with all or some of the following config parameters:</p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">icon</code></td>
      <td><code class="language-plaintext highlighter-rouge">/.config/awesome/awesome-wm-widgets/gerrit-widget/gerrit_icon.svg</code></td>
      <td>Path to the icon</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">host</code></td>
      <td>Required</td>
      <td>Ex https://gerrit.tmnt.com</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">query</code></td>
      <td><code class="language-plaintext highlighter-rouge">is:reviewer AND status:open AND NOT is:wip</code></td>
      <td>Query to retrieve reviews</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">timeout</code></td>
      <td>10</td>
      <td>How often in seconds the widget refreshes</td>
    </tr>
  </tbody>
</table>

<h2 id="prerequisite">Prerequisite</h2>

<ul>
  <li><a href="https://curl.haxx.se/">curl</a> - is used to communicate with gerritâ€™s <a href="https://gerrit-review.googlesource.com/Documentation/rest-api.html">REST API</a></li>
  <li>setup <a href="https://ec.haxx.se/usingcurl-netrc.html">netrc</a> which is used to store username and password in order to call APIâ€™s endpoints.</li>
</ul>

<h2 id="installation">Installation</h2>

<ol>
  <li>
    <p>This widget relies on Gerrit <a href="https://gerrit-review.googlesource.com/Documentation/rest-api.html">REST API</a>, so you need to have a permission to access it. You also need to setup <a href="https://ec.haxx.se/usingcurl-netrc.html">netrc</a>, as widget uses curl to communicate with API and you have to be authenticated. 
To test if you have access to API and netrc setup is correct run following command, you should have a json response:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  curl  <span class="nt">-s</span> <span class="nt">--request</span> GET <span class="nt">--netrc</span> https://gerrit-host.com/a/changes/<span class="se">\?</span>q<span class="se">\=</span>status:open+AND+NOT+is:wip+AND+is:reviewer | <span class="nb">tail</span> <span class="nt">-n</span> +2
</code></pre></div>    </div>
    <p>Note: <code class="language-plaintext highlighter-rouge">tail -n +2</code> is needed to skip first line of the response, as gerrit returns some characters there in order to prevent XSS hacks.</p>
  </li>
  <li>
    <p>Download json parser for lua from <a href="https://github.com/rxi/json.lua">github.com/rxi/json.lua</a> and place it under <strong>~/.config/awesome/</strong> (donâ€™t forget to star a repo):</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> wget <span class="nt">-P</span> ~/.config/awesome/ https://raw.githubusercontent.com/rxi/json.lua/master/json.lua
</code></pre></div>    </div>
  </li>
  <li>
    <p>Clone this repo (if not cloned yet) under <strong>~/.config/awesome/</strong>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> git clone https://github.com/streetturtle/awesome-wm-widgets.git ~/.config/awesome/
</code></pre></div>    </div>
  </li>
  <li>
    <p>Require widget at the top of the <strong>rc.lua</strong>:</p>

    <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">local</span> <span class="n">gerrit_widget</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"awesome-wm-widgets.gerrit-widget.gerrit"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add widget to the tasklist:</p>

    <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">s</span><span class="p">.</span><span class="n">mytasklist</span><span class="p">,</span> <span class="c1">-- Middle widget</span>
     <span class="p">{</span> <span class="c1">-- Right widgets</span>
         <span class="n">layout</span> <span class="o">=</span> <span class="n">wibox</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">fixed</span><span class="p">.</span><span class="n">horizontal</span><span class="p">,</span>
         <span class="o">...</span>
         <span class="c1">--default</span>
         <span class="n">gerrit_widget</span><span class="p">({</span><span class="n">host</span> <span class="o">=</span> <span class="s1">'https://gerrit.tmnt.com'</span><span class="p">}),</span>
         <span class="c1">--customized</span>
         <span class="n">gerrit_widget</span><span class="p">({</span>
             <span class="n">host</span> <span class="o">=</span> <span class="s1">'https://gerrit.tmnt.com'</span><span class="p">,</span>
             <span class="n">query</span> <span class="o">=</span> <span class="s1">'is:reviewer AND is:wip'</span>
         <span class="p">})</span>
         <span class="o">...</span>
</code></pre></div>    </div>
  </li>
</ol>

:ET