I"í<h1 id="bitbucket-widget">Bitbucket widget</h1>

<p>The widget shows the number of pull requests assigned to the user and when clicked shows them in the list with some additional information. When item in the list is clicked - it opens the pull request in the browser.</p>

<h2 id="how-it-works">How it works</h2>

<p>Widget uses cURL to query Bitbucketâ€™s <a href="https://developer.atlassian.com/bitbucket/api/2/reference/">REST API</a>. In order to be authenticated, widget uses a <a href="https://ec.haxx.se/usingcurl/usingcurl-netrc">netrc</a> feature of the cURL, which is basically allows storing basic auth credentials in a <strong>.netrc</strong> file in home folder.</p>

<p>Bitbucket allows using <a href="https://confluence.atlassian.com/bitbucket/app-passwords-828781300.html">App Passwords</a> (available in the account settings) - simply generate one for the widget and use it as password in <strong>.netrc</strong> file.</p>

<h2 id="customization">Customization</h2>

<p>It is possible to customize widget by providing a table with all or some of the following config parameters:</p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">icon</code></td>
      <td><code class="language-plaintext highlighter-rouge">~/.config/awesome/awesome-wm-widgets/bitbucket-widget/bitbucket-icon-gradient-blue.svg</code></td>
      <td>Path to the icon</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">host</code></td>
      <td>Required</td>
      <td>e.g <em>http://api.bitbucket.org</em></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">uuid</code></td>
      <td>Required</td>
      <td>e.g <em>{123e4567-e89b-12d3-a456-426614174000}</em></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">workspace</code></td>
      <td>Required</td>
      <td>Workspace ID</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">repo_slug</code></td>
      <td>Required</td>
      <td>Repository slug</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">timeout</code></td>
      <td>60</td>
      <td>How often in seconds the widget refreshes</td>
    </tr>
  </tbody>
</table>

<p>Note:</p>
<ul>
  <li>host most likely should start with <em>api.</em></li>
  <li>to get your UUID you may call <code class="language-plaintext highlighter-rouge">curl -s -n 'https://api.bitbucket.org/2.0/user'</code></li>
</ul>

<h2 id="installation">Installation</h2>

<p>Create a <strong>.netrc</strong> file in you home directory with following content:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>machine api.bitbucket.org
login mikey@tmnt.com
password cowabunga
</code></pre></div></div>

<p>Then change fileâ€™s permissions to 600 (so only you can read/write it):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>600 ~/.netrc
</code></pre></div></div>
<p>And test if it works by calling the API:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> <span class="nt">-n</span> <span class="s1">'https://api.bitbucket.org/2.0/repositories/'</span>
</code></pre></div></div>

<p>Also, to properly setup required parameters you can use <code class="language-plaintext highlighter-rouge">test_bitbucket_api.sh</code> script - it uses the same curl call as widget.</p>

<p>Then clone/download repo and use widget in <strong>rc.lua</strong>:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">bitbucket_widget</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"awesome-wm-widgets.bitbucket-widget.bitbucket"</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">s</span><span class="p">.</span><span class="n">mytasklist</span><span class="p">,</span> <span class="c1">-- Middle widget</span>
	<span class="p">{</span> <span class="c1">-- Right widgets</span>
    	<span class="n">layout</span> <span class="o">=</span> <span class="n">wibox</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">fixed</span><span class="p">.</span><span class="n">horizontal</span><span class="p">,</span>
		<span class="o">...</span>
		<span class="c1">-- default</span>
		<span class="n">bitbucket_widget</span><span class="p">({</span>
		    <span class="n">host</span> <span class="o">=</span> <span class="s1">'https://api.bitbucket.org'</span><span class="p">,</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="s1">'{123e4567-e89b-12d3-a456-426614174000}'</span><span class="p">,</span>
            <span class="n">workspace</span> <span class="o">=</span> <span class="s1">'workspace'</span><span class="p">,</span>
            <span class="n">repo_slug</span> <span class="o">=</span> <span class="s1">'slug'</span>

		<span class="p">}}),</span>
		<span class="o">...</span>
</code></pre></div></div>
:ET